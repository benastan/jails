(function(t){var e=function(t){return function(){return t.apply(this,arguments),this}},i=function(t){return t!==void 0},n=function(t){this.wrapper=t,this.queue=[]};n.prototype.flush=function(){for(var t;i(t=this.queue.shift());)this.wrapper(t)},n.prototype.push=function(t){"function"==typeof t&&this.queue.push(t)};var r=function(t){var e;return e=function(){return function(t){return"number"==typeof t?this.find(t):t instanceof Object?this.filter(t):void 0}.apply(e,arguments)},o.call(e,t),$.extend(e,r.prototype),e},o=function(t){t instanceof s?(this.query=t,this.model=t.model):this.model=t,this.models=[]};r.prototype.count=function(){return this.models.length},r.prototype.add=e(function(t){var e;if(arguments.length>1&&(t=Array.prototype.slice.apply(arguments)),t instanceof Array)for(var i in t)this.add(t[i]);else t instanceof this.model&&(t.id!==void 0&&(e=this.find(t.id))instanceof this.model&&(this.remove(e),t=this.model.mergeModels(e,t),t.id=t.id),this.models.push(t))}),r.prototype.remove=e(function(t){var e,i;e=t instanceof this.model?t:this.find(t),i=this.models.indexOf(e),this.models.splice(i,1)}),r.prototype.empty=e(function(){delete this.models,this.models=[]}),r.prototype.find=function(t){var e,i=this.models;for(var n in i)if(e=i[n],e.id===t)return e},r.prototype.clone=function(t){var e;e=r(this.model,this.query),t=t||this.models;for(var i in t)e.add(t[i]);return e},r.prototype.filter=function(t,e){var i,n,r=this.clone(),o=r.models,s={};if("string"==typeof t&&e!==void 0)s[t]=e;else{if(!(s instanceof Object))throw ArgumentError("Dataset::filter takes either two strings, or one hash of parameters");s=t}for(var u in o){i=o[u];for(t in s)e=s[t],n=i.get(t),("string"==typeof e&&e!=n||e instanceof RegExp&&e.test(n)===!1)&&o.splice(u,1)}return r.models=o,r},t.HTTP||function(){$.ajax.apply($,arguments)};var s=function(t,e){var i=this;this.model=t,this.queryParams={},this.fetchAll=!1,this.queue=new n(function(t){t.apply(i)}),!e instanceof r&&(e=new r(t,query))},u="limit page".split(" ");s.prototype.url=function(){var t=this.model;return"function"==typeof t.url?t.url():t.url},s.prototype.all=e(function(){this.fetchAll=!0,this.queryParams={}}),s.prototype.where=e(function(t,e){var i=this.queryParams.where||{};"string"==typeof t?i[t]=e:$.extend(i,t),this.queryParams.where=i}),s.prototype.query=e(function(){var e=this.model,i=this.dataset,n=this;t.HTTP({type:"GET",url:this.url(),data:this.queryParams,success:function(t){var r;for(var o in t)r=t[o],i.add(e(r));n.queue.flush()}})}),s.prototype.synced=e(function(t){this.queue.push(t)});for(var a=0,h=u.length;h>a;a++)(function(){var t=u[a];s.prototype[t]=e(function(e){this.fetchAll=!1,this.queryParams[t]=e})})();var d=function(t,e){for(var i,n=arguments.callee;"Child"===n.caller.name;)n=n.caller;if(this instanceof d){if(e===void 0?"number"==typeof t?(this.id=t,this.attributes={}):this.attributes=t||{}:(this.id=t,this.attributes=e),"id"in this.attributes&&(this.id===void 0&&(this.id=this.attributes.id),delete this.attributes.id),this.id!==void 0&&n.dataset.find(this.id)!==void 0)throw Error("Jailed in! Do not use `new Model()` to instantiate with id. Use `Model(id, attributes)`");this.setup(),this.klass=n,n.dataset.add(this)}else"number"==typeof t?e instanceof n?(i=e,i.id=t,n.remove(t),n.dataset.add(i)):null===e?n.remove(t):(i=n.find(t))===void 0&&(i=new n(t,e),i.set(e)):(e=t||e)!==void 0?"id"in e?(t=e.id,delete e.id,i=n(t,e)):i=new n(e):i=new n;return i};d.prototype.set=function(t,e){if("string"==typeof t||"number"==typeof t)this.attributes[t]=e;else for(var i in t)this.set(i,t[i])},d.prototype.get=function(t){var e,i;return e=this.attributes[t],e===void 0&&(i=this.klass.composers[t])!==void 0&&(e=i.apply(this.attributes)),e},d.prototype.setup=function(){var t=this;this.queue=new n(function(e){e.apply(t)})},d.find=function(t){return this.dataset.find(t)},d.add=function(t){return this.dataset.add(t)},d.remove=function(t){return this.dataset.remove(t)},d.prototype.synced=function(t){this.queue.push(t)},d.extend=function(t){var e,i=this;e=function(){return i.apply(this,arguments)},e.prototype=i.prototype;for(var n in this)this.hasOwnProperty(n)&&(e[n]=this[n]);for(n in t){var o=t[n],s=i.prototype[n];"function"==typeof o&&"function"==typeof s&&(o._super=s),e.prototype[n]=o}for(n in this.QueryMethods)e[n]=this.QueryMethods[n];return e.extend=this.extend,e.dataset=new r(e),e.composers={},e},d.QueryMethods="all limit page where".split(" ").reduce(function(t,e){return t[e]=function(){var t=new s(this);return t[e].apply(t,arguments)},t},{}),d.fetch=function(){return this.all().query()},d.count=function(){return this.dataset.count()},d.empty=function(){this.dataset.empty()},d.compose=function(t,e){"function"==typeof e&&(this.composers[t]=e)},d.mergeModels=function(){var t,e,i;return e=function(t,e){return t.push(e.attributes),t},i=Array.prototype.reduce.apply(arguments,[e,[]]),t=new this,i.unshift(t.attributes),$.extend.apply($,i),t},d.dataset=new r(d),d.composers={},window.Queue=t.Queue=n,window.Query=t.Query=s,window.Dataset=t.Dataset=r,window.Model=t.Model=d,window.Jails=t})({});
//@ sourceMappingURL=lib/jails.min.map