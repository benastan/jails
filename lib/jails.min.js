(function(){var t=this.Jails,e="undefined"==typeof window?module.exports:window.Jails={},i=function(t){return function(){return t.apply(this,arguments),this}},r=function(t){return t!==void 0},n=e;if("object"==typeof t)for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);var s=function(t){this.wrapper=t,this.queue=[]};s.prototype.flush=function(){for(var t;r(t=this.queue.shift());)this.wrapper(t)},s.prototype.push=function(t){"function"==typeof t&&this.queue.push(t)};var u=function(t){var e;return e=function(){return function(t){return"number"==typeof t?this.find(t):t instanceof Object?this.filter(t):void 0}.apply(e,arguments)},a.call(e,t),$.extend(e,u.prototype),e},a=function(t){t instanceof p?(this.query=t,this.model=t.model):this.model=t,this.models=[]};u.prototype.count=function(){return this.models.length},u.prototype.add=i(function(t){var e;if(arguments.length>1&&(t=Array.prototype.slice.apply(arguments)),t instanceof Array)for(var i in t)this.add(t[i]);else t instanceof this.model&&(t.id!==void 0&&(e=this.find(t.id))instanceof this.model&&(this.remove(e),t=this.model.mergeModels(e,t),t.id=t.id),this.models.push(t))}),u.prototype.remove=i(function(t){var e,i;e=t instanceof this.model?t:this.find(t),i=this.models.indexOf(e),this.models.splice(i,1)}),u.prototype.empty=i(function(){delete this.models,this.models=[]}),u.prototype.find=function(t){var e,i=this.models;for(var r in i)if(e=i[r],e.id===t)return e},u.prototype.clone=function(t){var e;e=u(this.model,this.query),t=t||this.models;for(var i in t)e.add(t[i]);return e},u.prototype.filter=function(t,e){var i,r,n,o=this.clone(),s=o.models,u={};if("string"==typeof t&&e!==void 0)u[t]=e;else{if(!(u instanceof Object))throw ArgumentError("Dataset::filter takes either two strings, or one hash of parameters");u=t}for(var a in s){i=s[a],n=s.indexOf(i);for(t in u)e=u[t],r=i.get(t),("string"==typeof e&&e!=r||e instanceof RegExp&&e.test(r)===!1)&&s.splice(n,1)}return o.models=s,o},u.prototype.at=function(t){return this.models[t]},u.prototype.first=function(){return this.at(0)},u.prototype.last=function(){return this.at(this.count())};var f=function(){this.request.apply(this,arguments)};f.request=function(){$.ajax.apply($,arguments)},n.dataSource=n.dataSource||f;var p=function(t,e){var i=this;this.model=t,this.queryParams={},this.fetchAll=!1,this.queue=new s(function(t){t.apply(i)}),!e instanceof u&&(e=new u(t,query))},h="limit page".split(" ");p.prototype.url=function(){var t=this.model;return"function"==typeof t.url?t.url():t.url},p.prototype.all=i(function(){this.fetchAll=!0,this.queryParams={}}),p.prototype.where=i(function(t,e){var i=this.queryParams.where||{};"string"==typeof t?i[t]=e:$.extend(i,t),this.queryParams.where=i}),p.prototype.query=i(function(){var t=this.model,e=this.dataset,i=this;n.dataSource({type:"GET",url:this.url(),data:this.queryParams,success:function(r){var n;for(var o in r)n=r[o],e.add(t(n));i.queue.flush()}})}),p.prototype.synced=i(function(t){this.queue.push(t)});for(var o=0,d=h.length;d>o;o++)(function(){var t=h[o];p.prototype[t]=i(function(e){this.fetchAll=!1,this.queryParams[t]=e})})();var l=function(t,e){for(var i,r=arguments.callee;"Child"===r.caller.name;)r=r.caller;if(this instanceof l){if(e===void 0?"number"==typeof t?(this.id=t,this.attributes={}):this.attributes=t||{}:(this.id=t,this.attributes=e),"id"in this.attributes&&(this.id===void 0&&(this.id=this.attributes.id),delete this.attributes.id),this.id!==void 0&&r.dataset.find(this.id)!==void 0)throw Error("Jailed in! Do not use `new Model()` to instantiate with id. Use `Model(id, attributes)`");this.setup(),this.klass=r,r.dataset.add(this)}else"number"==typeof t?e instanceof r?(i=e,i.id=t,r.remove(t),r.dataset.add(i)):null===e?r.remove(t):(i=r.find(t))===void 0&&(i=new r(t,e),i.set(e)):(e=t||e)!==void 0?"id"in e?(t=e.id,delete e.id,i=r(t,e)):i=new r(e):i=new r;return i};l.prototype.set=function(t,e){if("string"==typeof t||"number"==typeof t)this.attributes[t]=e;else for(var i in t)this.set(i,t[i])},l.prototype.get=function(t){var e,i;return e=this.attributes[t],e===void 0&&(i=this.klass.composers[t])!==void 0&&(e=i.apply(this.attributes)),e},l.prototype.setup=function(){var t=this;this.queue=new s(function(e){e.apply(t)})},l.prototype.synced=function(t){this.queue.push(t)},l.extend=function(t){var e,i=this;e=function(){return i.apply(this,arguments)},e.prototype=i.prototype;for(var r in this)this.hasOwnProperty(r)&&(e[r]=this[r]);return $.extend(e,l,t),e.extend=this.extend,e.dataset=new u(e),e.composers={},e};var c={"all limit page where":function(){return new p(this)},"count add remove find empty filter first last at":function(){return this.dataset}},y=function(t){var e=function(e){for(var i in t)e.push(i);return e}([]);return e.reduce(function(e,i){var r=i.split(" ");for(var n in r)e[r[n]]=function(t,e){return function(){var i,r=this;return i=t.apply(r),i[e].apply(i,arguments)}}(t[i],r[n]);return e},{})}(c);$.extend(l,y),l.fetch=function(){return this.all().query()},l.compose=function(t,e){"function"==typeof e&&(this.composers[t]=e)},l.mergeModels=function(){var t,e,i;return e=function(t,e){return t.push(e.attributes),t},i=Array.prototype.reduce.apply(arguments,[e,[]]),t=new this,i.unshift(t.attributes),$.extend.apply($,i),t},l.dataset=new u(l),l.composers={},n.Queue=s,n.Query=p,n.Dataset=u,n.Model=l})();
//@ sourceMappingURL=lib/jails.min.map